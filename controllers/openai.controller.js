
const jobApplicationService = require('../services/jobApplicationEditor.service');

// @desc Returns the job application data generated by the AI
// @route POST /api/openai/job-application-data
// @access Public
generateJobApplication = async (req, res, next) => {
    try {
        res.status(200).json(await jobApplicationService.generate(req.body));
    } catch (err) {
        next(err);
    }
};

// @desc Download of the generated file
// @route POST /api/openai/generate-export-file
// @access Public
exportJobApplication = async (req, res, next) => {
    try {
        const result = await jobApplicationService.exportFile(req.body);
        if (result.type === 'pdf') {
            res.setHeader('Content-Type', 'application/pdf');
            res.setHeader('Content-Disposition', 'attachment; filename=application.pdf');
        } else if (result.type === 'docx') {
            res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document');
            res.setHeader('Content-Disposition', 'attachment; filename=application.docx');
        }
        result.stream.pipe(res);
    } catch (err) {
        next(err);
    }
};


module.exports = {
    generateJobApplication,
    exportJobApplication
};
